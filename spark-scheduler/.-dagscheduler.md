### Spark源码分析-DAGScheduler

DAGSchduler概述，是一个面向Stage层的调度器

主要入参有：

dagScheduler.runJob\(rdd, cleanedFunc, partitions, callSite, allowLocal, resultHandler, localProperties.get\)

 rdd:find RDD

cleandFunc:计算每个分区的函数

resultHandler:结果侦听器

主要功能如下：

1、接收用户提交的job；

2、将job划分为不同的Stage，这里参考**Stage的划分**，记录哪些RDD、Stage被物化，并且在每一个Stage内产生一系列的task，并封装成TaskSet传递到executor上执行；

3、决定每个task的最佳位置（任务在数据所在的节点上），并结合当前缓存情况；将TaskSet提交给TaskScheduler；

4、重新提交Shuffle输出丢失的Stage给TaskScheduler；

注：一个Stage内部的错误不是由Shuffle造成的，DAGScheduler是不管的，由TaskScheduler负责尝试重新提交task执行；

---   

下面说下DAGScheduler的架构其实非常简单

1.eventQueue，所有需要DAGSchduler处理的事情都要往eventQueue中发送event

2. eventProcess Loop Thread，会不断的从eventQueue中获取event处理

3. 实现TaskSchedulerListener，并注册到TaskScheduler，这样TaskScheduler可以随时调用TaskSchedulerListener中的接口报告状况变更

TaskSchedulerListener的实现也就是post各种event到eventQueue

